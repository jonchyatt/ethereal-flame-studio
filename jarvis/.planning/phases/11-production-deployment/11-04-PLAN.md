---
phase: 11-production-deployment
plan: 04
type: execute
wave: 2
depends_on: ["11-01", "11-02", "11-03"]
files_modified: []
autonomous: false
user_setup:
  - service: vercel
    why: "Deploy to production"
    env_vars:
      - name: JARVIS_API_SECRET
        source: "Generate: openssl rand -hex 32"
      - name: NEXT_PUBLIC_JARVIS_SECRET
        source: "Same value as JARVIS_API_SECRET"
    dashboard_config:
      - task: "Verify all env vars are set"
        location: "Vercel Dashboard -> Project -> Settings -> Environment Variables"

must_haves:
  truths:
    - "Jarvis is accessible at jarvis.whatamiappreciatingnow.com"
    - "Dashboard shows real Notion data (tasks, calendar, habits, bills)"
    - "Voice conversation works (push-to-talk -> speech -> response)"
    - "API routes reject unauthenticated requests"
    - "Memory persists across browser sessions"
  artifacts: []
  key_links:
    - from: "jarvis.whatamiappreciatingnow.com"
      to: "Vercel deployment"
      via: "DNS + Vercel"
      pattern: "HTTPS connection"
---

<objective>
Deploy to production and verify all functionality works

Purpose: Final deployment and end-to-end verification of Jarvis on production. This plan depends on all Wave 1 plans completing successfully.

Output:
- Jarvis deployed to production via Vercel
- All 9 verification checklist items confirmed working
- Production deployment verified and stable
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@jarvis/.planning/phases/11-production-deployment/11-CONTEXT.md
@jarvis/.planning/phases/11-production-deployment/11-RESEARCH.md
@jarvis/.planning/phases/11-production-deployment/11-01-SUMMARY.md
@jarvis/.planning/phases/11-production-deployment/11-02-SUMMARY.md
@jarvis/.planning/phases/11-production-deployment/11-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pre-deployment verification</name>
  <files></files>
  <action>
Before deploying, verify all changes are ready:

1. Build passes locally:
   ```bash
   npm run build
   ```
   Confirm no child_process or other build errors.

2. Type check passes:
   ```bash
   npx tsc --noEmit
   ```

3. Verify required changes are in place:
   ```bash
   # Notion SDK installed
   npm ls @notionhq/client

   # MCP code parked
   ls src/lib/jarvis/notion/NotionClient.mcp.ts

   # Direct SDK in use
   grep "import.*@notionhq/client" src/lib/jarvis/notion/NotionClient.ts

   # Auth middleware in place
   grep "X-Jarvis-Secret" src/middleware.ts

   # Auth fetch wrapper exists
   ls src/lib/jarvis/api/fetchWithAuth.ts

   # Memory dedup uses upsert
   grep "onConflictDoUpdate" src/lib/jarvis/memory/queries/memoryEntries.ts
   ```

4. All changes committed:
   ```bash
   git status
   ```
   Should show clean working tree or only untracked files.
  </action>
  <verify>
- `npm run build` succeeds
- All verification commands pass
- No uncommitted changes to tracked files
  </verify>
  <done>Local build verified and ready for deployment</done>
</task>

<task type="auto">
  <name>Task 2: Deploy to production</name>
  <files></files>
  <action>
Deploy to Vercel production:

```bash
vercel --prod
```

Wait for deployment to complete. Note the deployment URL.

If deployment fails:
1. Check Vercel build logs for errors
2. Most likely cause: missing env vars
3. Verify JARVIS_API_SECRET and NEXT_PUBLIC_JARVIS_SECRET are set in Vercel

After successful deployment:
1. Note the deployment URL (should be jarvis.whatamiappreciatingnow.com)
2. Verify DNS is pointing to Vercel (should already be configured)
  </action>
  <verify>
- `vercel --prod` completes without error
- Deployment URL is accessible
  </verify>
  <done>Production deployment successful</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Jarvis production deployment with all fixes</what-built>
  <how-to-verify>
Run through the 9-point verification checklist at https://jarvis.whatamiappreciatingnow.com:

**1. Build passes** (automated - already verified by successful deployment)

**2. Deploy succeeds** (automated - already verified)

**3. Notion reads work**
   - Open dashboard
   - Verify tasks show real data (not empty or placeholder)
   - Verify calendar shows real events
   - Verify habits show real data
   - Verify bills show real data

**4. Notion writes work**
   - Start a check-in conversation
   - Say something that should create a task (e.g., "I need to call the dentist")
   - Verify task appears in Notion Inbox database

**5. Memory persists**
   - Have a conversation where Jarvis learns something
   - Close the browser completely
   - Reopen and verify Jarvis remembers

**6. Voice works**
   - Click push-to-talk button
   - Speak a phrase
   - Verify transcription appears
   - Verify Jarvis responds with speech

**7. Briefing works**
   - Click "Start Briefing" button
   - Verify briefing delivers morning briefing content
   - Should include tasks, calendar, weather (if configured)

**8. API secured**
   - Open browser DevTools -> Network tab
   - Try to access /api/jarvis/session directly without auth header
   - Should return 401 Unauthorized
   - Alternatively: `curl https://jarvis.whatamiappreciatingnow.com/api/jarvis/session`

**9. No env leaks**
   - Trigger an error (e.g., disconnect database temporarily)
   - Check that error response says "Internal server error" not full stack trace
   - Check browser console for any exposed API keys

Report any failures with specific details.
  </how-to-verify>
  <resume-signal>Type "all verified" if all 9 checks pass, or describe any failures</resume-signal>
</task>

</tasks>

<verification>
All verification is covered in the checkpoint task above.

Summary of verification checklist from 11-CONTEXT.md:
1. Build passes: `npm run build` succeeds without child_process error
2. Deploy succeeds: `vercel --prod` completes
3. Notion reads work: Dashboard shows real tasks, calendar, habits, bills
4. Notion writes work: Check-in captures items to Notion inbox
5. Memory persists: Close browser, reopen, memories still there
6. Voice works: Push-to-talk -> transcription -> response -> speech
7. Briefing works: "Start Briefing" button delivers morning briefing
8. API secured: Unauthenticated requests to /api/jarvis/* return 401
9. No env leaks: Production logs don't show API keys or stack traces
</verification>

<success_criteria>
1. Production deployment at jarvis.whatamiappreciatingnow.com is accessible
2. All 9 verification checklist items pass
3. User confirms functionality working
</success_criteria>

<output>
After completion, create `.planning/phases/11-production-deployment/11-04-SUMMARY.md`
</output>
