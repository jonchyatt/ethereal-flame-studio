---
phase: 05-executive-function-core
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/lib/jarvis/stores/dashboardStore.ts
  - src/components/jarvis/Dashboard/DashboardPanel.tsx
  - src/components/jarvis/Dashboard/TasksList.tsx
  - src/components/jarvis/Dashboard/BillsSummary.tsx
  - src/components/jarvis/Dashboard/HabitProgress.tsx
  - src/components/jarvis/Dashboard/CalendarEvents.tsx
  - src/components/jarvis/PriorityIndicator.tsx
  - src/app/jarvis/page.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "User sees current tasks and daily agenda as text alongside the orb"
    - "Priority items show visual 'needs attention' indicator"
    - "Dashboard sections are toggleable (tasks, calendar, habits, bills)"
    - "Dashboard is beside the orb, not over it"
    - "Mobile: collapsible drawer, orb stays visible"
    - "Desktop: right sidebar"
  artifacts:
    - path: "src/lib/jarvis/stores/dashboardStore.ts"
      provides: "Dashboard visibility and section state"
      exports: ["useDashboardStore"]
    - path: "src/components/jarvis/Dashboard/DashboardPanel.tsx"
      provides: "Main dashboard container"
      exports: ["DashboardPanel"]
    - path: "src/components/jarvis/Dashboard/TasksList.tsx"
      provides: "Today's tasks display with priority indicators"
      exports: ["TasksList"]
    - path: "src/components/jarvis/PriorityIndicator.tsx"
      provides: "Visual 'needs attention' indicator"
      exports: ["PriorityIndicator"]
  key_links:
    - from: "DashboardPanel.tsx"
      to: "dashboardStore"
      via: "useDashboardStore"
      pattern: "sections\\.(tasks|calendar|habits|bills)\\.visible"
    - from: "TasksList.tsx"
      to: "PriorityIndicator"
      via: "render for overdue/urgent"
      pattern: "PriorityIndicator.*type=\"overdue\""
    - from: "page.tsx"
      to: "DashboardPanel.tsx"
      via: "layout"
      pattern: "<DashboardPanel"
---

<objective>
Create the visual dashboard displaying tasks, calendar, habits, and bills alongside the orb.

Purpose: Users can see their current tasks and agenda at a glance without asking Jarvis. Priority items get visual attention indicators. The dashboard complements voice interaction with always-visible information.

Output: Responsive dashboard sidebar (desktop) / drawer (mobile) with toggleable sections and priority indicators.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@jarvis/.planning/PROJECT.md
@jarvis/.planning/ROADMAP.md
@jarvis/.planning/STATE.md
@jarvis/.planning/phases/05-executive-function-core/05-CONTEXT.md
@jarvis/.planning/phases/05-executive-function-core/05-RESEARCH.md

# Prior plan output
@jarvis/.planning/phases/05-executive-function-core/05-01-SUMMARY.md

# Existing architecture
@src/lib/jarvis/executive/types.ts
@src/lib/jarvis/executive/BriefingBuilder.ts
@src/lib/jarvis/stores/jarvisStore.ts
@src/app/jarvis/page.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboardStore and PriorityIndicator</name>
  <files>
    - src/lib/jarvis/stores/dashboardStore.ts
    - src/components/jarvis/PriorityIndicator.tsx
  </files>
  <action>
**Create `src/lib/jarvis/stores/dashboardStore.ts`:**

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface SectionState {
  visible: boolean;
  expanded: boolean;
}

interface DashboardState {
  isVisible: boolean;
  sections: {
    tasks: SectionState;
    calendar: SectionState;
    habits: SectionState;
    bills: SectionState;
  };
  pinnedItems: string[]; // page IDs for pinned items
  defaultView: 'minimal' | 'moderate' | 'full';
}

interface DashboardActions {
  setIsVisible: (visible: boolean) => void;
  toggleSection: (section: keyof DashboardState['sections']) => void;
  toggleSectionExpanded: (section: keyof DashboardState['sections']) => void;
  pinItem: (pageId: string) => void;
  unpinItem: (pageId: string) => void;
  setDefaultView: (view: DashboardState['defaultView']) => void;
}

export const useDashboardStore = create<DashboardState & DashboardActions>()(
  persist(
    (set) => ({
      // Default state - moderate view per CONTEXT.md
      isVisible: true,
      sections: {
        tasks: { visible: true, expanded: true },
        calendar: { visible: true, expanded: false },
        habits: { visible: true, expanded: false },
        bills: { visible: true, expanded: false },
      },
      pinnedItems: [],
      defaultView: 'moderate',

      // Actions
      setIsVisible: (isVisible) => set({ isVisible }),

      toggleSection: (section) =>
        set((state) => ({
          sections: {
            ...state.sections,
            [section]: {
              ...state.sections[section],
              visible: !state.sections[section].visible,
            },
          },
        })),

      toggleSectionExpanded: (section) =>
        set((state) => ({
          sections: {
            ...state.sections,
            [section]: {
              ...state.sections[section],
              expanded: !state.sections[section].expanded,
            },
          },
        })),

      pinItem: (pageId) =>
        set((state) => ({
          pinnedItems: [...state.pinnedItems, pageId],
        })),

      unpinItem: (pageId) =>
        set((state) => ({
          pinnedItems: state.pinnedItems.filter((id) => id !== pageId),
        })),

      setDefaultView: (defaultView) => set({ defaultView }),
    }),
    {
      name: 'jarvis-dashboard',
    }
  )
);
```

**Create `src/components/jarvis/PriorityIndicator.tsx`:**

```typescript
'use client';

interface PriorityIndicatorProps {
  type: 'overdue' | 'urgent' | 'deadline_near' | 'needs_attention';
  pulsing?: boolean;
  size?: 'sm' | 'md';
}

const colors: Record<PriorityIndicatorProps['type'], string> = {
  overdue: 'bg-red-500',
  urgent: 'bg-orange-500',
  deadline_near: 'bg-yellow-500',
  needs_attention: 'bg-amber-400',
};

const labels: Record<PriorityIndicatorProps['type'], string> = {
  overdue: 'Overdue',
  urgent: 'Urgent',
  deadline_near: 'Due soon',
  needs_attention: 'Needs attention',
};

export function PriorityIndicator({
  type,
  pulsing = true,
  size = 'sm',
}: PriorityIndicatorProps) {
  const sizeClasses = size === 'sm' ? 'h-2 w-2' : 'h-3 w-3';

  return (
    <span
      className={`
        inline-flex ${sizeClasses} rounded-full ${colors[type]}
        ${pulsing ? 'animate-pulse' : ''}
      `}
      title={labels[type]}
      aria-label={labels[type]}
    />
  );
}
```
  </action>
  <verify>
TypeScript compiles:
```bash
npx tsc --noEmit src/lib/jarvis/stores/dashboardStore.ts src/components/jarvis/PriorityIndicator.tsx
```
  </verify>
  <done>Dashboard store manages section visibility, PriorityIndicator shows attention dots</done>
</task>

<task type="auto">
  <name>Task 2: Create Dashboard section components</name>
  <files>
    - src/components/jarvis/Dashboard/TasksList.tsx
    - src/components/jarvis/Dashboard/BillsSummary.tsx
    - src/components/jarvis/Dashboard/HabitProgress.tsx
    - src/components/jarvis/Dashboard/CalendarEvents.tsx
  </files>
  <action>
Create `src/components/jarvis/Dashboard/` directory and components:

**TasksList.tsx:**
```typescript
'use client';

import { PriorityIndicator } from '../PriorityIndicator';
import type { TaskSummary } from '@/lib/jarvis/executive/types';

interface TasksListProps {
  tasks: TaskSummary[];
  overdue: TaskSummary[];
  loading: boolean;
  expanded: boolean;
}

export function TasksList({ tasks, overdue, loading, expanded }: TasksListProps) {
  if (loading) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Tasks</h3>
        <div className="animate-pulse space-y-2">
          <div className="h-4 bg-white/10 rounded" />
          <div className="h-4 bg-white/10 rounded w-3/4" />
        </div>
      </div>
    );
  }

  const allTasks = [...overdue, ...tasks];

  if (allTasks.length === 0) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Tasks</h3>
        <p className="text-white/40 text-sm">No tasks for today</p>
      </div>
    );
  }

  const displayTasks = expanded ? allTasks : allTasks.slice(0, 3);

  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Tasks</h3>
        {overdue.length > 0 && (
          <span className="text-red-400 text-xs">{overdue.length} overdue</span>
        )}
      </div>

      <ul className="space-y-1">
        {displayTasks.map((task) => (
          <li
            key={task.id}
            className="flex items-center gap-2 text-white/80 text-sm"
          >
            {task.isOverdue && <PriorityIndicator type="overdue" />}
            {task.priority === 'high' && !task.isOverdue && (
              <PriorityIndicator type="urgent" />
            )}
            <span className={task.isOverdue ? 'text-red-300' : ''}>
              {task.title}
            </span>
          </li>
        ))}
      </ul>

      {!expanded && allTasks.length > 3 && (
        <p className="text-white/40 text-xs">
          +{allTasks.length - 3} more
        </p>
      )}
    </div>
  );
}
```

**BillsSummary.tsx:**
```typescript
'use client';

import { PriorityIndicator } from '../PriorityIndicator';
import type { BillSummary } from '@/lib/jarvis/executive/types';

interface BillsSummaryProps {
  bills: BillSummary[];
  total: number;
  loading: boolean;
  expanded: boolean;
}

export function BillsSummary({ bills, total, loading, expanded }: BillsSummaryProps) {
  if (loading) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Bills</h3>
        <div className="animate-pulse h-4 bg-white/10 rounded w-1/2" />
      </div>
    );
  }

  if (bills.length === 0) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Bills</h3>
        <p className="text-white/40 text-sm">No bills due this week</p>
      </div>
    );
  }

  const todayBills = bills.filter((b) => b.isDueToday);
  const displayBills = expanded ? bills : bills.slice(0, 2);

  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Bills</h3>
        <span className="text-white/60 text-xs">
          ${total.toLocaleString()} total
        </span>
      </div>

      <ul className="space-y-1">
        {displayBills.map((bill) => (
          <li
            key={bill.id}
            className="flex items-center justify-between text-white/80 text-sm"
          >
            <div className="flex items-center gap-2">
              {bill.isDueToday && <PriorityIndicator type="deadline_near" />}
              <span>{bill.title}</span>
            </div>
            <span className="text-white/50">${bill.amount}</span>
          </li>
        ))}
      </ul>

      {!expanded && bills.length > 2 && (
        <p className="text-white/40 text-xs">+{bills.length - 2} more</p>
      )}
    </div>
  );
}
```

**HabitProgress.tsx:**
```typescript
'use client';

import type { HabitSummary } from '@/lib/jarvis/executive/types';

interface HabitProgressProps {
  habits: HabitSummary[];
  loading: boolean;
  expanded: boolean;
}

export function HabitProgress({ habits, loading, expanded }: HabitProgressProps) {
  if (loading) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Habits</h3>
        <div className="animate-pulse h-4 bg-white/10 rounded w-2/3" />
      </div>
    );
  }

  if (habits.length === 0) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Habits</h3>
        <p className="text-white/40 text-sm">No habits tracked</p>
      </div>
    );
  }

  const displayHabits = expanded ? habits : habits.slice(0, 3);

  return (
    <div className="space-y-2">
      <h3 className="text-white/60 text-xs uppercase tracking-wide">Habits</h3>

      <ul className="space-y-1">
        {displayHabits.map((habit) => (
          <li
            key={habit.id}
            className="flex items-center justify-between text-white/80 text-sm"
          >
            <span>{habit.title}</span>
            <span className="text-white/50">
              {habit.currentStreak}/{habit.targetStreak}
            </span>
          </li>
        ))}
      </ul>

      {!expanded && habits.length > 3 && (
        <p className="text-white/40 text-xs">+{habits.length - 3} more</p>
      )}
    </div>
  );
}
```

**CalendarEvents.tsx:**
```typescript
'use client';

import { PriorityIndicator } from '../PriorityIndicator';
import type { CalendarEvent } from '@/lib/jarvis/executive/types';

interface CalendarEventsProps {
  events?: CalendarEvent[];
  loading: boolean;
  expanded: boolean;
}

export function CalendarEvents({ events = [], loading, expanded }: CalendarEventsProps) {
  if (loading) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Calendar</h3>
        <div className="animate-pulse h-4 bg-white/10 rounded w-1/2" />
      </div>
    );
  }

  if (events.length === 0) {
    return (
      <div className="space-y-2">
        <h3 className="text-white/60 text-xs uppercase tracking-wide">Calendar</h3>
        <p className="text-white/40 text-sm">Clear calendar today</p>
      </div>
    );
  }

  const displayEvents = expanded ? events : events.slice(0, 2);

  return (
    <div className="space-y-2">
      <h3 className="text-white/60 text-xs uppercase tracking-wide">Calendar</h3>

      <ul className="space-y-1">
        {displayEvents.map((event) => (
          <li
            key={event.id}
            className="flex items-center gap-2 text-white/80 text-sm"
          >
            {event.isUpcoming && <PriorityIndicator type="deadline_near" pulsing={false} />}
            <span className="text-white/50">{event.time}</span>
            <span>{event.title}</span>
          </li>
        ))}
      </ul>

      {!expanded && events.length > 2 && (
        <p className="text-white/40 text-xs">+{events.length - 2} more</p>
      )}
    </div>
  );
}
```
  </action>
  <verify>
TypeScript compiles:
```bash
npx tsc --noEmit src/components/jarvis/Dashboard/*.tsx
```
  </verify>
  <done>Dashboard section components render tasks, bills, habits, calendar with loading states</done>
</task>

<task type="auto">
  <name>Task 3: Create DashboardPanel and integrate into page</name>
  <files>
    - src/components/jarvis/Dashboard/DashboardPanel.tsx
    - src/components/jarvis/Dashboard/index.ts
    - src/app/jarvis/page.tsx
    - src/app/globals.css
  </files>
  <action>
**Create `src/components/jarvis/Dashboard/DashboardPanel.tsx`:**

```typescript
'use client';

import { useState } from 'react';
import { useDashboardStore } from '@/lib/jarvis/stores/dashboardStore';
import { TasksList } from './TasksList';
import { CalendarEvents } from './CalendarEvents';
import { HabitProgress } from './HabitProgress';
import { BillsSummary } from './BillsSummary';
import type { BriefingData } from '@/lib/jarvis/executive/types';

interface DashboardPanelProps {
  data: BriefingData | null;
  loading: boolean;
}

export function DashboardPanel({ data, loading }: DashboardPanelProps) {
  const { sections, isVisible, setIsVisible } = useDashboardStore();
  const [mobileOpen, setMobileOpen] = useState(false);

  if (!isVisible) return null;

  // Mobile drawer toggle button
  const MobileToggle = () => (
    <button
      onClick={() => setMobileOpen(!mobileOpen)}
      className="fixed bottom-4 right-4 z-40 md:hidden
                 bg-white/10 backdrop-blur-md rounded-full p-3
                 border border-white/20"
      aria-label={mobileOpen ? 'Close dashboard' : 'Open dashboard'}
    >
      <svg
        className="w-6 h-6 text-white"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        {mobileOpen ? (
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
        ) : (
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
        )}
      </svg>
    </button>
  );

  // Desktop: sidebar | Mobile: drawer from right
  const panelClasses = `
    fixed z-20 bg-black/60 backdrop-blur-md
    border-white/10 overflow-y-auto

    /* Desktop: right sidebar */
    md:right-4 md:top-4 md:bottom-4 md:w-80
    md:rounded-2xl md:border

    /* Mobile: full-height drawer from right */
    ${mobileOpen ? 'right-0' : '-right-full'}
    top-0 bottom-0 w-80
    border-l transition-all duration-300
    md:translate-x-0
  `;

  return (
    <>
      {/* Mobile toggle button */}
      <MobileToggle />

      {/* Mobile backdrop */}
      {mobileOpen && (
        <div
          className="fixed inset-0 bg-black/40 z-10 md:hidden"
          onClick={() => setMobileOpen(false)}
        />
      )}

      {/* Dashboard panel */}
      <aside className={panelClasses}>
        <div className="p-4 space-y-6">
          {/* Header with close button on mobile */}
          <div className="flex items-center justify-between">
            <h2 className="text-white/80 text-sm font-medium">Today</h2>
            <button
              onClick={() => setIsVisible(false)}
              className="text-white/40 hover:text-white/60 text-xs"
              aria-label="Hide dashboard"
            >
              Hide
            </button>
          </div>

          {/* Tasks Section */}
          {sections.tasks.visible && (
            <TasksList
              tasks={data?.tasks.today || []}
              overdue={data?.tasks.overdue || []}
              loading={loading}
              expanded={sections.tasks.expanded}
            />
          )}

          {/* Divider */}
          {sections.tasks.visible && sections.calendar.visible && (
            <hr className="border-white/10" />
          )}

          {/* Calendar Events */}
          {sections.calendar.visible && (
            <CalendarEvents
              events={data?.calendar.today || []}
              loading={loading}
              expanded={sections.calendar.expanded}
            />
          )}

          {/* Divider */}
          {sections.calendar.visible && sections.habits.visible && (
            <hr className="border-white/10" />
          )}

          {/* Habits */}
          {sections.habits.visible && (
            <HabitProgress
              habits={data?.habits.active || []}
              loading={loading}
              expanded={sections.habits.expanded}
            />
          )}

          {/* Divider */}
          {sections.habits.visible && sections.bills.visible && (
            <hr className="border-white/10" />
          )}

          {/* Bills */}
          {sections.bills.visible && (
            <BillsSummary
              bills={data?.bills.thisWeek || []}
              total={data?.bills.total || 0}
              loading={loading}
              expanded={sections.bills.expanded}
            />
          )}
        </div>
      </aside>
    </>
  );
}
```

**Create `src/components/jarvis/Dashboard/index.ts`:**
```typescript
export { DashboardPanel } from './DashboardPanel';
export { TasksList } from './TasksList';
export { CalendarEvents } from './CalendarEvents';
export { HabitProgress } from './HabitProgress';
export { BillsSummary } from './BillsSummary';
```

**Update `src/app/jarvis/page.tsx`:**

1. Import DashboardPanel:
```typescript
import { DashboardPanel } from '@/components/jarvis/Dashboard';
import { buildMorningBriefing } from '@/lib/jarvis/executive/BriefingBuilder';
import type { BriefingData } from '@/lib/jarvis/executive/types';
```

2. Add dashboard data state and fetching:
```typescript
const [dashboardData, setDashboardData] = useState<BriefingData | null>(null);
const [dashboardLoading, setDashboardLoading] = useState(true);

// Fetch dashboard data on mount and periodically
useEffect(() => {
  async function fetchDashboardData() {
    setDashboardLoading(true);
    try {
      const data = await buildMorningBriefing();
      setDashboardData(data);
    } catch (error) {
      console.error('Failed to fetch dashboard data:', error);
    } finally {
      setDashboardLoading(false);
    }
  }

  fetchDashboardData();

  // Refresh every 5 minutes
  const interval = setInterval(fetchDashboardData, 5 * 60 * 1000);
  return () => clearInterval(interval);
}, []);
```

3. Render DashboardPanel alongside orb:
```typescript
return (
  <div className="relative h-dvh w-full bg-black overflow-hidden">
    {/* Orb - centered, pointer-events for tap */}
    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
      <div className="pointer-events-auto">
        <JarvisOrb ... />
      </div>
    </div>

    {/* Dashboard - beside orb, not over it */}
    <DashboardPanel data={dashboardData} loading={dashboardLoading} />

    {/* Nudge overlay */}
    <NudgeOverlay />

    {/* Other UI elements */}
  </div>
);
```

**Update `src/app/globals.css`** if needed for transition classes:
```css
/* Dashboard transition for mobile drawer */
.transition-all {
  transition-property: all;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}
```

**IMPORTANT - Per CONTEXT.md pitfall:**
Dashboard should be BESIDE orb, not OVER it. On desktop, the sidebar is to the right. On mobile, the orb stays visible and the drawer slides in from right. Orb z-index must be higher than dashboard backdrop.
  </action>
  <verify>
1. `npm run dev`
2. Navigate to /jarvis
3. Desktop: Dashboard appears as right sidebar, orb visible and tappable
4. Mobile: Toggle button in corner, drawer slides in
5. Orb remains tappable when dashboard is open
6. Sections show loading states, then data
7. Priority indicators show for overdue/urgent items
8. "Hide" button hides dashboard
  </verify>
  <done>Dashboard panel renders alongside orb with responsive layout</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Dev server starts: `npm run dev`
3. Desktop: Right sidebar shows tasks, calendar, habits, bills
4. Mobile: Drawer toggles from bottom-right button
5. Orb is always tappable (not blocked by dashboard)
6. Overdue tasks show red priority indicator
7. High-priority tasks show orange indicator
8. Bills due today show yellow indicator
9. Sections toggle visibility
10. Data refreshes every 5 minutes
</verification>

<success_criteria>
- Dashboard displays current tasks, calendar, habits, bills
- Priority indicators show for overdue/urgent/deadline items
- Sections are toggleable via store
- Desktop: sidebar layout, orb centered
- Mobile: drawer, orb stays visible
- Dashboard does NOT block orb interaction
- Data loads from Notion via BriefingBuilder
</success_criteria>

<output>
After completion, create `jarvis/.planning/phases/05-executive-function-core/05-03-SUMMARY.md`
</output>
