---
phase: 06-advanced-executive-function
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/jarvis/executive/LifeAreaTracker.ts
  - src/lib/stores/lifeAreaStore.ts
  - src/lib/jarvis/executive/types.ts
  - src/lib/jarvis/executive/BriefingBuilder.ts
autonomous: true

must_haves:
  truths:
    - "Jarvis can identify neglected life areas relative to baseline"
    - "Life area activity is tracked when tasks are completed"
    - "Neglect insights surface in briefings as gentle nudges"
    - "User baseline weights are persisted across sessions"
  artifacts:
    - path: "src/lib/jarvis/executive/LifeAreaTracker.ts"
      provides: "Rolling window activity tracking and neglect calculation"
      exports: ["LifeAreaTracker", "getLifeAreaTracker"]
    - path: "src/lib/stores/lifeAreaStore.ts"
      provides: "Zustand store for life area weights and activity history"
      exports: ["useLifeAreaStore"]
  key_links:
    - from: "src/lib/jarvis/executive/LifeAreaTracker.ts"
      to: "src/lib/stores/lifeAreaStore.ts"
      via: "store access for activity data"
      pattern: "useLifeAreaStore\\.getState"
    - from: "src/lib/jarvis/executive/BriefingBuilder.ts"
      to: "LifeAreaTracker"
      via: "getNeglectedAreas call"
      pattern: "getLifeAreaTracker.*getNeglectedAreas"
---

<objective>
Implement life area priority weighting system for triage suggestions.

Purpose: Per CONTEXT.md, Jarvis should surface neglected life areas as gentle awareness nudges ("Health has been quiet this week"), not aggressive prioritization. Weights are set by user baseline AND adjusted based on activity tracking. Mentioned in morning briefing, evening wrap, and weekly review.

Output: LifeAreaTracker service with rolling window activity tracking, neglect calculation, and Zustand store for persistence.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@jarvis/.planning/PROJECT.md
@jarvis/.planning/ROADMAP.md
@jarvis/.planning/phases/06-advanced-executive-function/06-CONTEXT.md
@jarvis/.planning/phases/06-advanced-executive-function/06-RESEARCH.md

# Existing patterns
@src/lib/jarvis/executive/BriefingBuilder.ts
@src/lib/jarvis/executive/types.ts
@src/lib/stores/dashboardStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create life area types and store</name>
  <files>
    src/lib/jarvis/executive/types.ts
    src/lib/stores/lifeAreaStore.ts
  </files>
  <action>
    1. In types.ts, add:
       ```typescript
       interface LifeAreaConfig {
         id: string;
         name: string;
         userPriority: number;          // User-set importance (1-5)
         expectedActivityPerWeek: number; // User-set baseline tasks/week
         color?: string;                 // For visual display
       }

       interface LifeAreaActivity {
         areaId: string;
         activityCounts: Record<string, number>; // ISO date -> count
       }

       interface LifeAreaNeglect {
         areaId: string;
         areaName: string;
         neglectScore: number;          // 0-1, higher = more neglected
         recentActivity: number;        // Tasks in last 7 days
         baseline: number;              // Expected tasks/week
         suggestedMessage: string;      // "Health has been quiet this week"
       }

       interface LifeAreaInsights {
         neglectedAreas: LifeAreaNeglect[];
         activeAreas: string[];
         lastUpdated: number;
       }
       ```

    2. Create src/lib/stores/lifeAreaStore.ts:
       - Use Zustand with persist middleware (same pattern as dashboardStore)
       - State:
         - areas: Record<string, LifeAreaConfig> (default life areas)
         - activityHistory: LifeAreaActivity[] (rolling activity data)
         - lastActivityRecorded: Record<string, number> (prevent double-counting per task)
       - Actions:
         - setAreaConfig(areaId: string, config: Partial<LifeAreaConfig>)
         - recordActivity(areaId: string, taskId: string) - idempotent per (taskId, date)
         - getActivityForArea(areaId: string, days: number): number
         - clearOldActivity() - prune data older than 30 days

    3. Default life areas (can be extended from Notion later):
       - health: { name: 'Health', userPriority: 4, expectedActivityPerWeek: 5 }
       - work: { name: 'Work', userPriority: 4, expectedActivityPerWeek: 15 }
       - relationships: { name: 'Relationships', userPriority: 4, expectedActivityPerWeek: 3 }
       - finance: { name: 'Finance', userPriority: 3, expectedActivityPerWeek: 2 }
       - personal: { name: 'Personal Growth', userPriority: 3, expectedActivityPerWeek: 3 }
       - home: { name: 'Home', userPriority: 3, expectedActivityPerWeek: 3 }

    4. Use skipHydration: true per RESEARCH.md to avoid SSR hydration issues
  </action>
  <verify>
    TypeScript compiles:
    ```bash
    cd C:\Users\jonch\Projects\ethereal-flame-studio && npx tsc --noEmit
    ```
  </verify>
  <done>
    - Life area types defined
    - Zustand store with persist middleware created
    - Default life areas configured
    - Idempotent activity recording prevents double-counting
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LifeAreaTracker service</name>
  <files>
    src/lib/jarvis/executive/LifeAreaTracker.ts
  </files>
  <action>
    1. Create LifeAreaTracker.ts class:
       - Singleton pattern (same as CheckInManager)
       - Uses lifeAreaStore for data access
       - ROLLING_WINDOW_DAYS = 28 (4-week baseline)
       - RECENT_WINDOW_DAYS = 7 (recent activity comparison)

    2. Implement calculateNeglect(areaId: string): LifeAreaNeglect | null
       - Get area config and activity history
       - Calculate:
         - recentActivity = sum of activity in last 7 days
         - calculatedBaseline = 4-week rolling average * (7/28)
         - effectiveBaseline = userBaseline || calculatedBaseline
         - neglectScore = Math.max(0, (effectiveBaseline - recentActivity) / effectiveBaseline)
       - Return null if neglectScore < 0.3 (not significantly neglected)
       - Generate suggestedMessage based on score:
         - 0.3-0.5: "{area} has been quiet this week"
         - 0.5-0.7: "{area} could use some attention"
         - 0.7+: "{area} hasn't seen activity recently"

    3. Implement getNeglectedAreas(): LifeAreaNeglect[]
       - Calculate neglect for all configured areas
       - Filter where neglectScore >= 0.3
       - Sort by neglectScore descending
       - Return top 3 (don't overwhelm)

    4. Implement getLifeAreaInsights(): LifeAreaInsights
       - Get neglected areas
       - Get active areas (areas with activity above baseline)
       - Return structured insights

    5. Implement recordTaskCompletion(taskId: string, areaId?: string):
       - If areaId provided, record activity
       - If not provided, try to infer from task (future: check task's Area relation)
       - Call store's recordActivity with idempotency

    6. Export singleton: getLifeAreaTracker()
  </action>
  <verify>
    TypeScript compiles:
    ```bash
    cd C:\Users\jonch\Projects\ethereal-flame-studio && npx tsc --noEmit
    ```
  </verify>
  <done>
    - LifeAreaTracker calculates neglect relative to baseline
    - 4-week rolling window for baseline calculation
    - Suggested messages are gentle nudges, not directives
    - Top 3 neglected areas returned (not overwhelming)
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate life area insights into briefings</name>
  <files>
    src/lib/jarvis/executive/BriefingBuilder.ts
    src/lib/jarvis/executive/BriefingFlow.ts
  </files>
  <action>
    1. In BriefingBuilder.ts:
       - Import getLifeAreaTracker
       - In buildMorningBriefing(), add life area insights:
         ```typescript
         const tracker = getLifeAreaTracker();
         const lifeAreaInsights = tracker.getLifeAreaInsights();
         ```
       - Add to BriefingData return (extend type if needed):
         ```typescript
         lifeAreas: {
           insights: lifeAreaInsights,
         }
         ```

    2. In BriefingFlow.ts, add life area mention:
       - After habits section (or as part of habits), if neglectedAreas.length > 0:
         - Add brief mention: "By the way, {suggestedMessage}" for top neglected area
       - Keep it subtle - single mention, not a section of its own
       - Per CONTEXT.md: "gentle nudge only - awareness, not aggressive prioritization"

    3. Update types.ts BriefingData interface to include:
       ```typescript
       lifeAreas?: {
         insights: LifeAreaInsights;
       }
       ```

    4. Note: Evening wrap and weekly review integration will use the same pattern
       (they call BriefingBuilder which now includes insights)
  </action>
  <verify>
    TypeScript compiles:
    ```bash
    cd C:\Users\jonch\Projects\ethereal-flame-studio && npx tsc --noEmit
    ```
  </verify>
  <done>
    - BriefingBuilder includes life area insights
    - BriefingFlow mentions neglected areas subtly
    - Mention is gentle awareness, not directive
  </done>
</task>

</tasks>

<verification>
1. Types compile: `npx tsc --noEmit` passes
2. lifeAreaStore persists to localStorage
3. LifeAreaTracker calculates neglect scores correctly
4. BriefingData includes lifeAreas.insights
5. Morning briefing can mention neglected areas
</verification>

<success_criteria>
- LifeAreaTracker.ts exists with complete implementation
- useLifeAreaStore persists area config and activity
- Neglect calculation uses rolling window baseline
- Suggested messages are gentle ("has been quiet") not aggressive
- BriefingBuilder includes life area insights
- Integration is subtle - awareness nudge only
</success_criteria>

<output>
After completion, create `jarvis/.planning/phases/06-advanced-executive-function/06-02-SUMMARY.md`
</output>
